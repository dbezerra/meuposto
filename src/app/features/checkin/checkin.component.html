<div class="app-wrapper">
  <section class="shell">
    <div class="col col-left">
      <div class="card header-time">
        <div class="time">{{ now | date:'HH:mm' }}</div>
        <div class="date-wrapper">
          <span class="day-of-week">{{ now | date:'EEEE' | uppercase }}</span>
          <span class="full-date">{{ now | date:'dd \'de\' MMMM \'de\' y' | titlecase }}</span>
        </div>
      </div>

      <div class="card preview">
        <video #videoEl muted playsinline></video>
        <canvas #canvasEl></canvas>

        <div class="caption" [ngClass]="'caption--' + tipo">
          <svg
            class="action-icon"
            width="26.51"
            height="26.51"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="3"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m9 18 6-6-6-6"></path>
          </svg>
          <span>{{ label(tipo) }}</span>
        </div>
        
        <!-- Status da c√¢mera - apenas quando h√° problemas -->
        <div class="camera-status" *ngIf="statusMsg && (statusMsg.includes('Erro') || statusMsg.includes('Permiss√£o') || statusMsg.includes('HTTPS') || statusMsg.includes('n√£o suporta'))">
          <p>{{ statusMsg }}</p>
          
          <!-- Bot√£o para solu√ß√µes HTTPS -->
          <button *ngIf="statusMsg.includes('HTTPS')" 
                  (click)="showHttpsSolutions({name: 'Chrome', version: 'Unknown'})" 
                  class="btn-https">
            üîí Solu√ß√µes HTTPS
          </button>
          
          <!-- Bot√£o para solicitar permiss√£o de c√¢mera -->
          <button *ngIf="showPermissionButton" 
                  (click)="requestCameraPermission()" 
                  class="btn-permission">
            üì∑ Permitir Acesso √† C√¢mera
          </button>
          
          <!-- Bot√£o de instru√ß√µes -->
          <button *ngIf="showPermissionButton" 
                  (click)="showCameraInstructions()" 
                  class="btn-instructions">
            ‚ùì Como Permitir C√¢mera
          </button>
          
          <!-- Bot√£o para tentar novamente em caso de erro -->
          <button *ngIf="statusMsg.includes('Erro') && !showPermissionButton" 
                  (click)="reloadPage()" 
                  class="btn-retry">
            üîÑ Tentar Novamente
          </button>
        </div>
      </div>
    </div>

    <div class="col col-right">
      <div class="card logo-card">
        <img
          src="assets/img/totvs-logo.png"
          alt="TOTVS"
          class="logo-img-sidebar"
        />
      </div>

      <div class="card manual">
        <h3>Apontamento manual</h3>
        <p>Digite seu CPF</p>

        <div class="input-box"><span>{{ formattedCPF }}</span></div>

        <div class="keypad">
          <button class="key" (click)="onKeypadClick('1')">1</button>
          <button class="key" (click)="onKeypadClick('2')">2</button>
          <button class="key" (click)="onKeypadClick('3')">3</button>
          <button class="key" (click)="onKeypadClick('4')">4</button>
          <button class="key" (click)="onKeypadClick('5')">5</button>
          <button class="key" (click)="onKeypadClick('6')">6</button>
          <button class="key" (click)="onKeypadClick('7')">7</button>
          <button class="key" (click)="onKeypadClick('8')">8</button>
          <button class="key" (click)="onKeypadClick('9')">9</button>
          <button class="key" (click)="onKeypadClick('0')">0</button>
          <button class="key key--erase" (click)="onKeypadClick('erase')">Apagar</button>
        </div>
      </div>

      <div class="help">
        <a routerLink="/" class="btn-help">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          Ajuda
        </a>
      </div>
    </div>
  </section>
</div>
